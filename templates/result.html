{% extends "layout.html" %}

{% block body %}
{#
{% macro set_color(cell) %}
    {% if cell == ' ' %}
        bgcolor="#f9c381"
    {% elif cell == 'A' %}
        bgcolor="#ff0000"
    {% elif cell == 'QP' %}
        bgcolor="#668cff"
    {% elif cell == 'J' %}
        bgcolor="#99d68d"
    {% elif cell == 'T' or cell == 'L' %}
        bgcolor="#ffeba5"
    {% endif %}
{% endmacro %}

{% with messages = get_flashed_messages() %}
   {% if messages %}
      {% for message in messages %}
         {{ message }}
      {% endfor %}
   {% endif %}
{% endwith %}

{% if nametest %}
    <p>{{ nametest }}</p>
{% endif %}

<table>
    <tr>
        <th></th>

    {% for time_slot in time_slots %}
        <th>{{ time_slot }}</th>
    {% endfor %}
   
    {% for idx in range(list_len) %}
    <tr>

        <div class="name">
        <td>{{ staff_list[idx].name }}</td>
        </div>
        {% for column in time_slots %}
            <td {{ set_color(table[idx][loop.index0]) }}>
                {{ table[idx][loop.index0] }}
            </td>
        {% endfor %}

    </tr>
    {% endfor %}
</table>
#}

<br>

<div>
<form action="/timesheet/gen">
    <button type="submit" formaction="/uploads/test.txt">Download timesheet</button>
    <button type="submit">Generate a new one</button>
</form>
</div>

<button type="button" onclick="createTable()">Try it</button>

<script>
    function createTable() {
        $.getJSON($SCRIPT_ROOT + "timesheet/t", function(result) {
            
            //var target = document.getElementById('test');
            var tbl = document.createElement('table');
            tbl.setAttribute('border', '1');
            
            var lenRow = Object.keys(result.table).length; 
            var lenCol = result.table[Object.keys(result.table)[0]].length;

            for (var i = 0; i < lenRow; i++) {
                var tr = tbl.insertRow();
                
                for (var j = 0; j < lenCol; j++) {
                    var td = tr.insertCell();
                    if (j == 0) {
                        if (i == 0) {
                            td.appendChild(document.createTextNode(''));
                        } else {
                            td.appendChild(document.createTextNode
                                (result.names[i - 1]));
                        }
                    } else {
                    td.appendChild(document.createTextNode
                        (result.table[Object.keys(result.table)[i]][j]));
                    }
                }
            }
            var div = document.getElementById('test');
            while(div.firstChild){
                div.removeChild(div.firstChild);
            }
            //document.getElementById('test').innterHTML = "";
            document.getElementById('test').appendChild(tbl);
         });
    };
</script>

<div id="test"></div>
{% endblock %}
