{% extends "layout.html" %}

{% block body %}

<br>
<!--<form action="/form" method="POST">
    <label for="number">Number of staff:</label>
    <input type="number" class="form-control" name="num"><br>
    <button type="submit" class="btn btn-default">Submit</button>
</form> 
-->
<br>
<form id="staff_number">
    <label for="number">Number of staff:</label>
    <input type="number" class="form-control" name="num" id="form"><br>
    <button type="submit">Submit</button>
</form>

<br>

<div id="new_form">
   
</div>

<script>
function test() {
    console.log("holaaa");
    return false;
}

window.onload=function() {
    document.getElementById("staff_number").onsubmit=function() {
    var value = document.getElementById("form").value;
    console.log(value);
    generateForm(value);
    return false;
    }
}


function generateForm(value) {
    var f = document.createElement("form");
    f.setAttribute('action', "/timesheet");
    f.setAttribute('method', "POST");

    for (var i = 0; i < value; i++) {
        // p
        f.appendChild(gen_p_staff(i));

        // input
        f.appendChild(gen_input_tag(i));

        // job selector
        f.appendChild(gen_job_selector(i));

        // start selector + label
        var lb = document.createElement("label");
        lb.appendChild(document.createTextNode(" Starting Time: "));
        f.appendChild(lb);
        f.appendChild(gen_time_selector(i, "start"));

        // finish selector + label
        lb = document.createElement("label");
        lb.appendChild(document.createTextNode(" Finishing Time: "));
        f.appendChild(lb);
        f.appendChild(gen_time_selector(i, "finish"));
    }  
    
    // hidden field
    var hidden = document.createElement("input");
    hidden.setAttribute('type', "hidden");
    hidden.setAttribute('name', "num");
    hidden.setAttribute('value', value);
    var staff_num = value;
    f.appendChild(hidden);


    // button
    var br = document.createElement("br");
    f.append(br);
    var btn = document.createElement("button");
    btn.setAttribute('type', "submit");
    btn.appendChild(document.createTextNode("Submit"));
    f.appendChild(btn);

    
    document.getElementById("new_form").appendChild(f);
}
    

// Generate <p> with staff number
function gen_p_staff(num) {
    var p = document.createElement("p");
    var p_content = "Staff " + (num + 1);
    p.appendChild(document.createTextNode(p_content));
        //f.appendChild(p);
    return p;
}


// Generate <input> tag
function gen_input_tag(num) {
    var inp = document.createElement("input");
    inp.setAttribute('placeholder', "name");
    inp.setAttribute('name', "name" + (num + 1));
    return inp;
}


// Generate <select> tag for jobs
function gen_job_selector(num) {
    var job_selector = document.createElement("select");
    job_selector.setAttribute('name', "job" + (num + 1));

    var value = ["DLM", "SUP", "LA", "RA"];
    var text_value = ["Manager", "Supervisor", "Assistant", "Relief"];
    
    for (var i = 0; i < value.length; i++) {
        var opt = document.createElement("option");
        opt.setAttribute('value', value[i]);
        
        if (value[i] === "LA") {
            opt.setAttribute('selected', "");
        }
        
        opt.appendChild(document.createTextNode(text_value[i]));
        job_selector.appendChild(opt);
    }
    return job_selector;
}


// Generate <select> tag for starting time
function gen_time_selector(num, time) {
    var time_selector = document.createElement("select");
    time_selector.setAttribute('name', time + (num + 1));
    
    var start_value = [0, 1, 2, 3, 4, 5, 6, 7, 8];
    var start_time = ["9:00", "10:00", "10:20", "10:40", "11:00", "12:00",
                    "1:00", "2:00", "3:00"];
    var finish_value = [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16];
    var finish_time = ["1:00", "2:00", "3:00", "3:20", "3:40", "4:00", "5:00",
                    "5:30", "6:00", "7:00", "8:00"];
    var selection_value;
    var selection_time;

    if (time === "start") {
        selection_value = start_value;
        selection_time = start_time;
    } else {
        selection_value = finish_value;
        selection_time = finish_time;
    }

    for (var i = 0; i < selection_value.length; i++) {
        var opt = document.createElement("option");
        opt.setAttribute('value', selection_value[i]);

        if (selection_value[i] === 0 || selection_value[i] === 16) {
            opt.setAttribute('selected', "");
        }
        
        opt.appendChild(document.createTextNode(selection_time[i]));
        time_selector.appendChild(opt);
    }
    return time_selector;

}   
</script>
{% endblock %}
